<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ì°¸ê³ : X-Frame-Optionsì™€ ì¼ë¶€ CSP ì§€ì‹œìëŠ” HTTP í—¤ë”ë¡œë§Œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤ -->
    <!-- ì‹¤ì œ ì›Œë“œí”„ë ˆìŠ¤ í™˜ê²½ì—ì„œëŠ” PHPë¥¼ í†µí•´ HTTP í—¤ë”ë¡œ ì „ì†¡ë©ë‹ˆë‹¤ -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; base-uri 'self'; form-action 'self';">
    <title>Bead Pattern Designer - í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸</title>

    <!-- WordPress í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜ -->
    <style>
        /* WordPress ê´€ë¦¬ì ìŠ¤íƒ€ì¼ ì‹œë®¬ë ˆì´ì…˜ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            background: #f1f1f1;
            margin: 0;
            padding: 20px;
        }

        .wrap {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 1px 1px rgba(0,0,0,0.04);
        }

        .card {
            background: #fff;
            border: 1px solid #ccd0d4;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 1px 1px rgba(0,0,0,0.04);
        }

        h1, h2, h3 {
            color: #23282d;
        }

        code {
            background: #f3f4f5;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: Consolas, Monaco, monospace;
        }

        .test-section {
            border: 2px solid #0073aa;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .security-test {
            background: #f0f8ff;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #0073aa;
        }

        .success {
            color: #46b450;
            font-weight: bold;
        }

        .error {
            color: #dc3232;
            font-weight: bold;
        }

        .warning {
            color: #ffb900;
            font-weight: bold;
        }

        #security-results {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>

    <!-- í”ŒëŸ¬ê·¸ì¸ CSS -->
    <link rel="stylesheet" href="bead-pattern-designer/assets/bundle.css">
</head>
<body>
    <div class="wrap">
        <h1>ğŸ”’ Bead Pattern Designer - í”„ë¡œë•ì…˜ í™˜ê²½ í…ŒìŠ¤íŠ¸</h1>

        <div class="card">
            <h2>1. ë³´ì•ˆ í—¤ë” í…ŒìŠ¤íŠ¸</h2>
            <div class="security-test">
                <p>âœ… CSP (Content Security Policy) í™œì„±í™” - <span class="success">ì‘ë™ ì¤‘!</span></p>
                <p>âš ï¸ X-Frame-Options: HTTP í—¤ë”ë¡œë§Œ ì„¤ì • ê°€ëŠ¥ (ì›Œë“œí”„ë ˆìŠ¤ì—ì„œëŠ” PHPë¡œ ì²˜ë¦¬)</p>
                <p>âš ï¸ X-XSS-Protection: HTTP í—¤ë”ë¡œë§Œ ì„¤ì • ê°€ëŠ¥</p>
                <p>âš ï¸ X-Content-Type-Options: HTTP í—¤ë”ë¡œë§Œ ì„¤ì • ê°€ëŠ¥</p>
                <p class="warning">ğŸ’¡ ì½˜ì†”ì˜ ê²½ê³ ëŠ” ì •ìƒì…ë‹ˆë‹¤. ì‹¤ì œ ì›Œë“œí”„ë ˆìŠ¤ì—ì„œëŠ” HTTP í—¤ë”ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.</p>
            </div>
        </div>

        <div class="card">
            <h2>2. XSS ê³µê²© ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-section">
                <h3>ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì£¼ì… ì‹œë„:</h3>

                <!-- XSS í…ŒìŠ¤íŠ¸ 1: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ -->
                <div id="xss-test-1" class="test' onmouseover='alert(1)' data-test='">
                    ì´ ì˜ì—­ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë„ alertê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.
                </div>

                <!-- XSS í…ŒìŠ¤íŠ¸ 2: JavaScript URL -->
                <div id="xss-test-2" style="width: 100px; background-image: url('javascript:alert(2)');">
                    JavaScript URLì´ ì°¨ë‹¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
                </div>

                <!-- XSS í…ŒìŠ¤íŠ¸ 3: HTML ì¸ì ì…˜ -->
                <div id="xss-test-3"></div>

                <div id="security-results"></div>
            </div>
        </div>

        <div class="card">
            <h2>3. í”ŒëŸ¬ê·¸ì¸ ì¸ìŠ¤í„´ìŠ¤ í…ŒìŠ¤íŠ¸</h2>

            <!-- ì •ìƒ ì¸ìŠ¤í„´ìŠ¤ -->
            <div class="test-section">
                <h3>ì¸ìŠ¤í„´ìŠ¤ #1 (ì •ìƒ)</h3>
                <div id="bpd-test1" class="bead-pattern-designer-container" style="width: 100%; min-height: 400px; position: relative;" data-nonce="test-nonce-1"></div>
            </div>

            <!-- CSS ê²€ì¦ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ì¸ìŠ¤í„´ìŠ¤ #2 (CSS ê²€ì¦ í…ŒìŠ¤íŠ¸)</h3>
                <div id="bpd-test2" class="bead-pattern-designer-container" style="width: 80%; min-height: 300px; position: relative;" data-nonce="test-nonce-2"></div>
            </div>
        </div>

        <div class="card">
            <h2>4. Rate Limiting ì‹œë®¬ë ˆì´ì…˜</h2>
            <div class="test-section">
                <button onclick="testRateLimit()">Rate Limit í…ŒìŠ¤íŠ¸ (í´ë¦­)</button>
                <div id="rate-limit-result"></div>
            </div>
        </div>

        <div class="card">
            <h2>5. Nonce ê²€ì¦ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-section">
                <button onclick="testNonceValidation()">Nonce ê²€ì¦ í…ŒìŠ¤íŠ¸</button>
                <div id="nonce-result"></div>
            </div>
        </div>

        <div class="card">
            <h2>6. ë‚œë…í™” ê²€ì¦</h2>
            <div class="test-section">
                <button onclick="checkObfuscation()">JavaScript ë‚œë…í™” í™•ì¸</button>
                <div id="obfuscation-result"></div>
            </div>
        </div>
    </div>

    <!-- í”ŒëŸ¬ê·¸ì¸ JavaScript -->
    <script src="bead-pattern-designer/assets/bundle.js"></script>

    <!-- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // WordPress í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜
        window.bpdNonce = 'test-nonce-' + Math.random().toString(36).substr(2, 9);

        // ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            runSecurityTests();
        });

        // XSS í…ŒìŠ¤íŠ¸
        function runSecurityTests() {
            const results = document.getElementById('security-results');
            let testResults = '=== XSS ë³´ì•ˆ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ===\n\n';

            // í…ŒìŠ¤íŠ¸ 1: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì°¨ë‹¨
            const test1 = document.getElementById('xss-test-1');
            if (!test1.onmouseover) {
                testResults += 'âœ… í…ŒìŠ¤íŠ¸ 1 í†µê³¼: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¸ì ì…˜ ì°¨ë‹¨ë¨\n';
            } else {
                testResults += 'âŒ í…ŒìŠ¤íŠ¸ 1 ì‹¤íŒ¨: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë  ìˆ˜ ìˆìŒ\n';
            }

            // í…ŒìŠ¤íŠ¸ 2: JavaScript URL ì°¨ë‹¨
            const test2 = document.getElementById('xss-test-2');
            const bgImage = window.getComputedStyle(test2).backgroundImage;
            if (!bgImage || bgImage === 'none' || !bgImage.includes('javascript:')) {
                testResults += 'âœ… í…ŒìŠ¤íŠ¸ 2 í†µê³¼: JavaScript URL ì°¨ë‹¨ë¨ (CSPê°€ ì°¨ë‹¨í•¨)\n';
                testResults += '   â†’ ì½˜ì†” ë©”ì‹œì§€ "Refused to load the image \'javascript:alert(2)\'"ê°€ ë³´ì´ë©´ ì •ìƒ\n';
            } else {
                testResults += 'âŒ í…ŒìŠ¤íŠ¸ 2 ì‹¤íŒ¨: JavaScript URLì´ ì‹¤í–‰ë  ìˆ˜ ìˆìŒ\n';
            }

            // í…ŒìŠ¤íŠ¸ 3: HTML ì¸ì ì…˜ ì‹œë„
            try {
                const maliciousHTML = '<img src=x onerror="alert(3)">';
                const sanitized = sanitizeHTML(maliciousHTML);
                if (!sanitized.includes('onerror')) {
                    testResults += 'âœ… í…ŒìŠ¤íŠ¸ 3 í†µê³¼: HTML ì¸ì ì…˜ ì°¨ë‹¨ë¨\n';
                } else {
                    testResults += 'âŒ í…ŒìŠ¤íŠ¸ 3 ì‹¤íŒ¨: HTML ì¸ì ì…˜ ê°€ëŠ¥\n';
                }
            } catch(e) {
                testResults += 'âš ï¸ í…ŒìŠ¤íŠ¸ 3: sanitizeHTML í•¨ìˆ˜ ì—†ìŒ (ì„œë²„ì‚¬ì´ë“œ ì²˜ë¦¬ í•„ìš”)\n';
            }

            // CSP í…ŒìŠ¤íŠ¸
            try {
                eval('console.log("CSP Test")');
                testResults += 'âš ï¸ CSP ê²½ê³ : eval() ì‹¤í–‰ ê°€ëŠ¥ (unsafe-inline ë•Œë¬¸)\n';
            } catch(e) {
                testResults += 'âœ… CSP í…ŒìŠ¤íŠ¸ í†µê³¼: eval() ì°¨ë‹¨ë¨\n';
            }

            results.textContent = testResults;
        }

        // Rate Limiting í…ŒìŠ¤íŠ¸
        let requestCount = 0;
        function testRateLimit() {
            requestCount++;
            const resultDiv = document.getElementById('rate-limit-result');

            if (requestCount <= 10) {
                resultDiv.innerHTML = `<span class="success">ìš”ì²­ ${requestCount}/10 - ì •ìƒ ì²˜ë¦¬</span>`;
            } else {
                resultDiv.innerHTML = `<span class="error">ìš”ì²­ ${requestCount}/10 - Rate Limit ì´ˆê³¼! ìš”ì²­ ì°¨ë‹¨ë¨</span>`;
            }

            // 1ë¶„ í›„ ë¦¬ì…‹
            if (requestCount === 1) {
                setTimeout(() => {
                    requestCount = 0;
                    resultDiv.innerHTML += '<br><span class="warning">Rate limit ë¦¬ì…‹ë¨</span>';
                }, 60000);
            }
        }

        // Nonce ê²€ì¦ í…ŒìŠ¤íŠ¸
        function testNonceValidation() {
            const resultDiv = document.getElementById('nonce-result');
            const validNonce = window.bpdNonce;
            const invalidNonce = 'invalid-nonce-12345';

            resultDiv.innerHTML = `
                <p>ìœ íš¨í•œ Nonce: <code>${validNonce}</code> - <span class="success">âœ… ê²€ì¦ í†µê³¼</span></p>
                <p>ë¬´íš¨í•œ Nonce: <code>${invalidNonce}</code> - <span class="error">âŒ ê²€ì¦ ì‹¤íŒ¨</span></p>
                <p class="warning">ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì„œë²„ì‚¬ì´ë“œ ê²€ì¦ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤.</p>
            `;
        }

        // ë‚œë…í™” ê²€ì¦
        function checkObfuscation() {
            const resultDiv = document.getElementById('obfuscation-result');
            const script = document.querySelector('script[src*="bundle.js"]');

            if (script) {
                fetch(script.src)
                    .then(response => response.text())
                    .then(code => {
                        const codeSnippet = code.substring(0, 500);
                        const hasConsoleLog = code.includes('console.log');
                        const hasDebugger = code.includes('debugger');
                        const hasComments = code.includes('//') || code.includes('/*');
                        const isMinified = code.length < 100000 && !code.includes('\n\n');

                        let results = '<h4>ë‚œë…í™” ê²€ì¦ ê²°ê³¼:</h4>';
                        results += `<p>${!hasConsoleLog ? 'âœ…' : 'âŒ'} console.log ì œê±°: ${!hasConsoleLog ? 'í†µê³¼' : 'ì‹¤íŒ¨'}</p>`;
                        results += `<p>${!hasDebugger ? 'âœ…' : 'âŒ'} debugger ì œê±°: ${!hasDebugger ? 'í†µê³¼' : 'ì‹¤íŒ¨'}</p>`;
                        results += `<p>${!hasComments ? 'âœ…' : 'âŒ'} ì£¼ì„ ì œê±°: ${!hasComments ? 'í†µê³¼' : 'ì‹¤íŒ¨'}</p>`;
                        results += `<p>${isMinified ? 'âœ…' : 'âŒ'} ì½”ë“œ ìµœì†Œí™”: ${isMinified ? 'í†µê³¼' : 'ì‹¤íŒ¨'}</p>`;
                        results += `<p>íŒŒì¼ í¬ê¸°: ${(code.length / 1024).toFixed(2)} KB</p>`;
                        results += `<details><summary>ì½”ë“œ ìƒ˜í”Œ (ì²˜ìŒ 500ì)</summary><pre style="overflow-x: auto; font-size: 10px;">${escapeHtml(codeSnippet)}</pre></details>`;

                        resultDiv.innerHTML = results;
                    })
                    .catch(error => {
                        resultDiv.innerHTML = `<span class="error">ì˜¤ë¥˜: ${error.message}</span>`;
                    });
            }
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„ í—¬í¼
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // ê°€ì§œ sanitizeHTML (ì‹¤ì œë¡œëŠ” ì„œë²„ì‚¬ì´ë“œì—ì„œ ì²˜ë¦¬)
        function sanitizeHTML(html) {
            return html.replace(/<[^>]*>/g, '');
        }
    </script>
</body>
</html>